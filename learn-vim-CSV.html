<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="zh" xml:lang="zh">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" type="text/css" href="learn-vi.css" />
	<title>VIM学习笔记 编辑CSV数据文件</title>
</head>
<body>
	<p><a href="https://fileinfo.com/extension/csv" title=".CSV File Extension">CSV</a>是一种以逗号分隔值的文本文件，常用于电子表格程序，如 Microsoft Excel 或 OpenOffice Calc。CSV 文件中的每一行代表数据库中的一行，而每行数据又由一个或多个以逗号分隔的字段组成。</p>
	<p>针对典型的CSV数据处理场景，以下将结合Vim内置命令、操作系统命令和<a style="font-weight: bold;" href="http://github.com/chrisbra/csv.vim" title="csv.vim">csv.vim</a>插件进行操作演示。</p>
	<p>您也可以使用<a href="https://kutt.it/vim-rb-csv" title="Rainbow-CSV">Rainbow CSV</a>等其他插件执行类似操作。</p>

	<h2 class="article"><a id="install">安装配置</a></h2>
	<p>推荐使用<a href="https://yyq123.github.io/learn-vim/learn-vim-plugin-minpac.html" title="插件管理器(minpac)">minpac</a>等插件管理器，来安装GitHub上的<a href="http://github.com/chrisbra/csv.vim" title="csv.vim">csv.vim</a>插件。（请参阅官方<a href=https://github.com/chrisbra/csv.vim?tab=readme-ov-file#installation" title="installation">安装文档</a>）</p>

	<h2 class="article"><a id="frozen-headers">固定标题行</a></h2>
	<p>通过以下步骤，将文件拆分在两个水平窗口中显示并绑定滚动，可以保持标题行始终置顶显示：</p>
	<ol>
		<li>打开CSV文件，使用<code class="inset">:set nowrap</code>命令，取消折行显示；</li>
		<li>使用<code class="inset">:sp</code>命令，水平分割窗口，然后点击<kbd>1Ctrl-w_</kbd>快捷键，调整窗口尺寸仅显示首行；</li>
		<li>点击<kbd>Ctrl-wj</kbd>快捷键，跳转到下一窗口；</li>
		<li>使用<code class="inset">:set scrollopt=hor</code>命令，显示横向滚动条；使用<code class="inset">:set scrollbind</code>命令，绑定滚动；</li>
		<li>点击<kbd>Ctrl-wk</kbd>快捷键，跳转到上一窗口；</li>
		<li>使用<code class="inset">:set scrollbind</code>命令，绑定滚动；</li>
	</ol>
	<p>此时在文件中左右移动，标题行与内容将自动同步对齐：</p>
	<p><a href="http://yyq123.github.io/learn-vim/images/CSV-Frozen-Headers.png" title="CSV-Frozen-Headers.png"><img src="http://yyq123.github.io/learn-vim/images/CSV-Frozen-Headers.png" alt="CSV-Frozen-Headers.png" /></a></p>
	<p>使用<a href="https://github.com/chrisbra/csv.vim" title="csv.vim">csv.vim</a>插件，执行以下命令可以固定标题行：</p>
	<p style="text-indent:2em"><code class="inset">:Header</code></p>
	<p>执行以下命令可以取消固定标题行：</p>
	<p style="text-indent:2em"><code class="inset">:Header!</code></p>

	<h2 class="article"><a id="column">按列对齐</a></h2>
	<p>假设有以下逗号分割的CSV文件，如下图红线所示，数据列没有对齐：</p>
	<p><a href="https://yyq123.github.io/learn-vim/images/CSV-Column-Align-Before.png" title="CSV-Column-Align-Before"><img src="https://yyq123.github.io/learn-vim/images/CSV-Column-Align-Before.png" alt="CSV-Column-Align-Before" width="550" height="84" /></a></p>
	<p>通过<a href="http://yyq123.github.io/learn-vim/learn-vim-Shell-Filter.html" title="过滤器(Filter)">过滤器</a>使用<a href="http://man.he.net/?topic=column&section=all" title="column">column</a>外部命令来按列对齐：</p>
	<p style="text-indent:2em"><code class="inset">:%!column -t</code></p>
	<p><a href="https://yyq123.github.io/learn-vim/images/CSV-Column-Align-After.png" title="CSV-Column-Align-After"><img src="https://yyq123.github.io/learn-vim/images/CSV-Column-Align-After.png" alt="CSV-Column-Align-After" width="550" height="77" /></a></p>
	<p>使用<a href="https://github.com/chrisbra/csv.vim" title="csv.vim">csv.vim</a>插件，执行以下命令可以按列对齐：</p>
	<p style="text-indent:2em"><code class="inset">:%ArrangeColumn</code></p>
	<p><a href="https://yyq123.github.io/learn-vim/images/plugin_csv_ArrangeColumn.png" title="plugin_csv_ArrangeColumn"><img src="https://yyq123.github.io/learn-vim/images/plugin_csv_ArrangeColumn.png" alt="plugin_csv_ArrangeColumn" width="550" height="55" /></a></p>

	<h2 class="article"><a id="sort"></a>按列排序</h2>
	<p>调用外部<a href="https://www.gnu.org/software/coreutils/manual/html_node/sort-invocation.html" title="sort">sort</a>命令，可以按照第2列进行排序：</p>
	<p style="text-indent:2em"><code class="inset">:%!sort -t ',' -k2</code></p>
	<p>使用<a href="https://github.com/chrisbra/csv.vim" title="csv.vim">csv.vim</a>插件，执行以下命令可以按照第2列进行排序：</p>
	<p style="text-indent:2em"><code class="inset">:Sort 2</code></p>

	<h2 class="article"><a id="merge-columns"></a>按列合并</h2>
	<p>假设names.txt文件，包含姓名信息：</p>
	<pre class="block">Jason
Cameron
Tim</pre>
	<p>假设numbers.txt文件，包含电话信息：</p>
	<pre class="block">555-1234
555-9876
555-2468</pre>
	<p>使用以下Linux命令，可以将多个文件按列合并：</p>
	<p style="text-indent:2em"><code class="inset">$ paste names.txt numbers.txt</code></p>
	<p><a href="https://yyq123.github.io/learn-vim/images/CSV-Column-Merge-paste.png" title="CSV-Column-Merge-paste"><img src="https://yyq123.github.io/learn-vim/images/CSV-Column-Merge-paste.png" alt="CSV-Column-Merge-paste" /></a></p>

	<h2 class="article"><a id="merge-files">按行合并</a></h2>
	<p>在Windows中，使用copy命令可以合并多个文件：</p>
	<p style="text-indent:2em"><code class="inset">$ copy *.csv merged-filname.csv</code></p>
	<p>在Linux中，使用cat命令可以合并多个文件：</p>
	<p style="text-indent:2em"><code class="inset">$ cat *.csv &gt; merged-file.csv</code></p>

	<h2 class="article"><a id="split-files">拆分文件</a></h2>
	<p>调用外部<a href="https://www.gnu.org/software/coreutils/manual/html_node/split-invocation.html">split</a>命令，可以按照制定行数拆分成多个文件：</p>
	<p style="text-indent:2em"><code class="inset">$ split -l200 passengers.csv --verbose</code></p>
	<pre class="block">creating file ‘xaa’
creating file ‘xab’
creating file ‘xac’
creating file ‘xad’
creating file ‘xae’</pre>
	<p>调用外部 <a href="https://www.gnu.org/software/coreutils/manual/html_node/wc-invocation.html">wc</a>.命令，可以统计文件包含的行数：</p>
	<p style="text-indent:2em"><code class="inset">$ wc -l xa*</code></p>
	<pre class="block">200 xaa
200 xab
200 xac
200 xad
 92 xae
892 total</pre>

	<h2 class="article"><a id="del-empty-lines">删除空行</a></h2>
	<p>使用以下命令，可以删除所有空行：</p>
	<p style="text-indent:2em"><code class="inset">:%g/^ *$/d</code></p>

	<h2 class="article"><a id="info">数据统计</a></h2>
	<p>使用以下命令，可以查找并计数行内的逗号数量</p>
	<p style="text-indent:2em"><code class="inset">:s/,/,/gn</code></p>
	<p>使用<a href="https://github.com/chrisbra/csv.vim" title="csv.vim">csv.vim</a>插件，执行以下命令可以显示当前行的列数：</p>
	<p style="text-indent:2em"><code class="inset">:NrColumns!</code></p>

	<p style="border-top:1px solid lightgray"><span style="float:right">Ver: 250723&nbsp;|&nbsp;<a href="mailto:yyq123@gmail.com">YYQ</a></span><span>&lt;<a title="插件管理器(minpac)" href="https://kutt.it/vim-minpa">上一篇</a>&nbsp;|<a title="笔记列表" href="http://yyq123.github.com/learn-vim/learn-vi-00-00-TOC.html">&nbsp;目录&nbsp;</a>|&nbsp;<a title="Rainbow CSV数据编辑" href="https://kutt.it/vim-rb-csv">下一篇</a>&gt;</span></p>

</body>
</html>
